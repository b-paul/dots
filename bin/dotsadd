#! /usr/bin/env bash

set -e

SOURCE=$BASH_SOURCE
while [ -h $SOURCE ]; do
  NEW_SOURCE="$(readlink $SOURCE)"
  [[ $NEW_SOURCE != /* ]] && NEW_SOURCE="$(dirname $SOURCE)/$NEW_SOURCE"
  SOURCE=$NEW_SOURCE
done

cd "$(dirname $SOURCE)"
cd "$(git rev-parse --show-toplevel)"

for file in $@; do
  sourceloc="$HOME/$file"
  targetloc="$PWD/$file"
  if [ -f $sourceloc ]; then
    mkdir -p "$(dirname $targetloc)"
    cp "$sourceloc" "$targetloc" && ln -sf "$targetloc" "$sourceloc" || rm "$targetloc"
  fi
done

